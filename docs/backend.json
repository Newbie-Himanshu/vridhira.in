
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account in the Vridhira Marketplace.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "Display name of the user."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile photo, if available.",
          "format": "uri"
        },
        "phoneNumber": {
          "type": "string",
          "description": "Phone number of the user."
        },
        "creationTime": {
          "type": "string",
          "description": "Timestamp of when the user account was created.",
          "format": "date-time"
        },
        "lastSignInTime": {
          "type": "string",
          "description": "Timestamp of the user's last sign-in.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Accessible only to the user themselves. Path-based ownership ensures that only the authenticated user (whose UID matches userId) can read or write their data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, matching the Firebase Authentication UID."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "AdminRole",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection to store admin roles. The existence of a document with a user's ID in this collection grants them admin privileges. No data about the user needs to be duplicated here.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who has admin privileges. Presence of the document grants admin access."
            }
          ]
        }
      }
    ],
    "reasoning": "This design prioritizes security and scalability for the Vridhira Marketplace. It leverages path-based ownership for user data and a dedicated collection for admin roles. The key principle is Authorization Independence.  User profiles are stored under `/users/{userId}`. This enables simple, secure rules based on `request.auth.uid == userId`.  To manage administrative access to revenue control and order management, a dedicated collection `/roles_admin/{uid}` is used. The existence of a document in this collection grants admin privileges.  This avoids complex role hierarchies. Because this application only deals with basic user information and admin access, denormalization is not applicable. QAPs are supported by segregating user data and admin roles into distinct collections, each with its own security rules, ensuring secure `list` operations. Path based user data is used to restrict user data visibility. DBAC is achieved via the `/roles_admin/{uid}` collection to determine administrative access."
  }
}
